#!/bin/bash

yay_install() {
    git clone https://aur.archlinux.org/yay.git
    cd yay
    makepkg -si --noconfirm
    cd -
    rm -rf yay
}

install_apps() {
    programas=(
        nano
        i3
        neofetch
        base-devel
        htop
        rofi
        dmenu
        xfce4-terminal
        clipit
        flameshot
        udiskie
        dunst
    )

    sudo pacman -Sy --noconfirm
    sudo pacman -S --noconfirm "${programas[@]}"
}

install_yay_packages() {
    packages=(
        jdk8-openjdk
        google-chrome
        vscodium-bin
        intellij-idea-community-edition
        intellij-idea-ultimate-edition
        intellij-idea-ultimate-edition-jre
        dbeaver
        maven
        gstreamer
        gst-plugins-ugly
        ntfs-3g
        exfat-utils
        fuse-exfat
        brave-bin
        chromium
        gitahead-bin
        discord
        slack-desktop
        xscreensaver
        microsoft-edge-stable-bin
        fish
        pamac
    )

    yay -S --noconfirm "${packages[@]}"
}

install_fish() {
    curl -L https://get.oh-my.fish | fish
    omf theme
    omf install agnoster
}

config_dunst() {
    mkdir -p ~/.config/dunst && echo -e "[global]\nfont = Sans 15" > ~/.config/dunst/dunstrc 
}

# Funci贸n para configurar picom
config_picom() {
    # Instalar picom
    sudo pacman -S --noconfirm picom

    # Realizar copia de seguridad del archivo de configuraci贸n existente, si lo hay
    if [ -f "/etc/xdg/picom.conf" ]; then
        sudo mv /etc/xdg/picom.conf /etc/xdg/picom.conf.bak
    fi

    # Crear o editar el archivo de configuraci贸n de picom
    sudo nano /etc/xdg/picom.conf <<EOF
# Shadows
shadow = true;
shadow-radius = 8;
shadow-opacity = 0.6;
shadow-offset-x = -3;
shadow-offset-y = -3;
shadow-exclude = [
  "class_g ?= 'i3-frame'"
];
# Fading
fading = true;
fade-in-step = 0.03;
fade-out-step = 0.03;
fade-delta = 4;
# Transparency / Opacity
inactive-opacity = 1;
frame-opacity = 1.0;
inactive-opacity-override = false;
detect-client-opacity = true;
focus-exclude = [ "class_g = 'Cairo-clock'" ];
opacity-rule = [
  "90:class_g = 'URxvt'",
  "97:class_g = 'Anki'",
  "70:class_g = 'i3bar'"
];
# General settings
backend = "glx";
vsync = true;
mark-wmwin-focused = true;
mark-ovredir-focused = true;
detect-rounded-corners = true;
detect-client-opacity = true;
# refresh-rate = 75;
use-ewmh-active-win = true;
detect-transient = true;
detect-client-leader = true;
use-damage = true;
log-level = "warn";
wintypes:
{
  tooltip = { fade = true; shadow = true; opacity = 1; focus = true; full-shadow = false; };
  dock = { shadow = false; opacity: 0.8; }
  dnd = { shadow = false; }
  popup_menu = { opacity = 0.8; }
  dropdown_menu = { opacity = 1; }
};
unredir-if-possible = false;

blur-background = true;
blur-method = "dual_kawase";
blur-strength = 1;
EOF
}

create_xinitrc() {
    cat <<EOF >"$HOME/.xinitrc"
setxkbmap -layout es

nm-applet &
clipit &
flameshot &
udiskie --tray &
dunst &
picom &
xscreensaver &
pamac-tray &

exec i3
EOF
}

# Llamar a la funci贸n para configurar picom
configurar_picom

install_apps
yay_install
install_yay_packages
config_dunst
config_picom
create_xinitrc
install_fish