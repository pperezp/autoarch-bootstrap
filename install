#!/bin/bash
script_dir="$(cd "$(dirname "$0")" && pwd)"
sudo -v

yay_install() {
    # Verificar si yay ya estÃ¡ instalado
    if ! command -v yay &>/dev/null; then
        echo "yay is not installed. Installing..."
        git clone https://aur.archlinux.org/yay.git
        cd yay
        makepkg -si --noconfirm
        cd -
        rm -rf yay
    else
        echo "yay is already installed."
    fi
}

install_minimal_apps() {
    packages=(
        base-devel
        chromium
        gstreamer
        gst-plugins-ugly
        ntfs-3g
        exfat-utils
        fuse-exfat
        xscreensaver
        nano
        i3
        neofetch
        htop
        rofi
        dmenu
        xfce4-terminal
        clipit
        flameshot
        udiskie
        dunst
        mousepad
        nitrogen
        network-manager-applet
        thunar
        picom
        octopi
        octopi-notifier-qt5
        ttf-hack-nerd
        python-requests
        fish
    )

    yay -Sy
    yay -S --noconfirm "${packages[@]}"
}

install_complete_apps() {
    packages=(
        visual-studio-code-bin
        jdk8-openjdk
        google-chrome
        microsoft-edge-stable-bin
        brave-bin
        intellij-idea-community-edition
        intellij-idea-ultimate-edition
        intellij-idea-ultimate-edition-jre
        dbeaver
        maven
        discord
        slack-desktop
    )

    yay -S --noconfirm "${packages[@]}"
}

install_oh_my_fish() {
    cd ~
    git clone https://github.com/oh-my-fish/oh-my-fish
    cd oh-my-fish/bin
    chmod +x install
    ./install --noninteractive
    fish -c "omf install agnoster"
}

config_dunst() {
    local dunstrc_path="$HOME/.config/dunst/dunstrc"
    
    # Verificar si el archivo dunstrc ya existe
    if [ -f "$dunstrc_path" ]; then
        echo "The dunst configuration file already exists."
    else
        # Si el archivo dunstrc no existe, crearlo y configurarlo
        mkdir -p ~/.config/dunst && echo -e "[global]\nfont = Sans 15" > "$dunstrc_path"
        echo "The dunst configuration file has been created."
    fi
}

config_picom() {
    sudo rm /etc/xdg/picom.conf
    cd $script_dir
    sudo cp picom.conf /etc/xdg/picom.conf
}

create_xinitrc() {
    cd $script_dir
    cp xinitrc ~/.xinitrc
}

generate_xfce4_terminal_config() {
    local config_dir="$HOME/.config/xfce4/xfconf/xfce-perchannel-xml"
    local config_file="$config_dir/xfce4-terminal.xml"

    mkdir -p "$config_dir"
    cd $script_dir
    cp xfce4-terminal.xml $config_file
    echo "File created at $config_file"
}

install_bumblebee_status() {
    cd ~/.config
    git clone https://github.com/tobi-wan-kenobi/bumblebee-status
}

copy_i3_config_file() {
    cd $script_dir
    mkdir -p ~/.config/i3
    cp i3/config ~/.config/i3/config
}

install_apps() {
    install_minimal_apps

    if [ "$1" == "complete" ]; then
        install_complete_apps
    fi
}

yay_install
install_apps
config_dunst
config_picom
create_xinitrc
generate_xfce4_terminal_config
install_bumblebee_status
copy_i3_config_file
install_oh_my_fish
